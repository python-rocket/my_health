# My Health Frontend - Architecture Guide

This guide contains a high level overview about the technical architecture, which languages and packages are used and the folder structure.

## Architecture Overview

### Tech Stack

**Frontend:**
- Vanilla TypeScript/HTML/CSS (no framework)
- Compiled TypeScript to JavaScript (`main.ts` â†’ `main.js`)
- Single-page application with tab-based navigation
- Client-side routing via tab switching

**Backend Services:**

1. **Node.js/Express Server (Port 3001)**
   - Serves static files (HTML, CSS, JS)
   - Provides REST API endpoints:
     - `GET /api/channels` - Fetches all YouTube channels from PostgreSQL
     - `GET /api/solutions` - Fetches all solutions from PostgreSQL
     - `GET /api/preferences` - Retrieves user preferences from JSON file
     - `POST /api/preferences` - Saves user preferences to JSON file
   - PostgreSQL connection via `pg` library
   - File-based preference storage (`dist/preferences.json`)

2. **FastAPI Server (Port 3002)**
   - Python-based API for AI question answering
   - Endpoint: `POST /ask` - Accepts prompts and returns AI responses
   - Uses `ask.py` module with OpenAI integration
   - CORS enabled for cross-origin requests

**Database:**
- PostgreSQL database
- Tables: `channels`, `solutions`
- Connection via `DATABASE_URL` environment variable

### File Structure

```
modules/frontend/
- contains UI
- contains node js server

modules/youtube_summarizer/
- contains backend api
```

---

## Environment Variables

**Required:**
- `DATABASE_URL` - PostgreSQL connection string (format: `postgresql://user:password@host:port/database`)

**Optional (for Ask functionality):**
- OpenAI API key (configured in `ask.py` module)

---

## Ports

- **Port 3001:** Node.js/Express frontend server (static files + API)
- **Port 3002:** FastAPI backend server (Ask functionality)

---

## Key Implementation Details

1. **Preference Storage:** File-based JSON storage in `dist/preferences.json`, persisted across server restarts
2. **Prompt Enhancement:** Automatic appending of favorite channels happens in frontend before API call
3. **Response Parsing:** Handles nested JSON structures from FastAPI (`data.response.result` or `data.response`)
4. **Security:** HTML escaping implemented for user-generated content display
5. **Error Handling:** Comprehensive error handling with user-friendly messages
6. **Tab Management:** Client-side tab switching with automatic data refresh

